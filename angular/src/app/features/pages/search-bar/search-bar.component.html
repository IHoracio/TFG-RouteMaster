<section>
  <form (ngSubmit)="onSubmit()" #form="ngForm">
    <p>
      <label for="origin">Elige el origen:</label>
      <input type="text" id="origin" name="origin" [(ngModel)]="routeFormResponse.origin" placeholder="¿Desde dónde?"
        required #originField="ngModel" />

      @if(originField && originField.touched){
    <div class="error">
      @if(originField.errors?.['required']){
      Tienes que introducir un origen.
      }
    </div>
    }
    </p>


    <p>
      <select name="destinationType" id="destinationType" [(ngModel)]="destinationType" #required>
        <option value="">¿Qué quieres introducir?</option>
        <option value="coordinates">Destino</option>
        <option value="favouriteGasStations">Gasolinera favorita</option>
      </select>
    </p>

    @if(destinationType === "coordinates"){
    <p>
      <label for="destination">Elige el destino:</label>
      <input type="text" id="destination" name="destination" [(ngModel)]="routeFormResponse.destination"
        placeholder="¿A dónde quieres ir?" required #destinationField="ngModel" />

      @if(destinationField && destinationField.touched){
    <div class="error">
      @if(destinationField.errors?.['required']){
      Tienes que introducir un destino.
      }
    </div>
    }
    </p>
    }



    @if(destinationType === "favouriteGasStations"){
    <select name="gasStation" id="gasStation" [(ngModel)]="routeFormResponse.destination">
      <option value="">Elige una gasolinera</option>
      <option *ngFor="let gasStation of favouriteGasStations()" [value]="gasStation.direccion">
        {{ gasStation.alias }} - {{ gasStation.marca }}
      </option>
    </select>
    }

    <button type="button" (click)="addWaypoint()">Añadir punto intermedio</button>


    <div *ngFor="let waypoint of routeFormResponse.waypoints; let i = index; trackBy: trackByIndex">
      <input type="text" [name]="'waypoint' + i" [(ngModel)]="routeFormResponse.waypoints[i]" />
    </div>
    <button type="button" (click)="deleteWaypoint()">Eliminar punto intermedio</button>

    <p>
      <label for="optimizeRoute">Optimizar puntos intermedios</label>
      <select [(ngModel)]="routeFormResponse.optimizeWaypoints" name="optimizeWaypoints" id="optimizeWaypoints">
        <option [value]="false">No</option>
        <option [value]="true">Sí</option>
      </select>
    </p>

    <p>
      <label for="optimizeRoute">Optimizar la ruta</label>
      <select [(ngModel)]="routeFormResponse.optimizeRoute" name="optimizeRoute" id="optimizeRoute">
        <option [value]="false">No</option>
        <option [value]="true">Sí</option>
      </select>
    </p>

    <p>
      <label for="avoidTolls">Evitar peajes</label>
      <select [(ngModel)]="routeFormResponse.avoidTolls" name="avoidTolls" id="avoidTolls">
        <option [value]="false">No</option>
        <option [value]="true">Sí</option>
      </select>
    </p>

    <p>
      <label for="vehiculeEmissionType">Tipo de combustible</label>
      <select [(ngModel)]="routeFormResponse.vehiculeEmissionType" name="vehiculeEmissionType"
        id="vehiculeEmissionType">
        @for (item of vehiculeEmissionTypeOptions | keyvalue; track item.key){
        <option [value]="item.key">{{item.value}}</option>
        }
      </select>
    </p>

    <button type="submit" [disabled]="!form.valid">Enviar</button>

    

    @if (submitted){
    <label for="routeAlias">Guardar ruta</label>
    <input type="text" id="routeAlias" name="routeAlias" [(ngModel)]="routeAlias" placeholder="Alias de la ruta" />

    <button type="button" (click)="saveRoute()">Guardar ruta</button>
    }

    <!-- Mostrar mensaje de éxito -->
    <div *ngIf="successfulMessage" class="success">
      {{ successfulMessage }}
    </div>

    <!-- Mostrar mensaje de error -->
    <div *ngIf="errorMessage" class="error">
      {{ errorMessage }}
    </div>
  </form>


  <app-map-page></app-map-page>


</section>